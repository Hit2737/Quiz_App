{% extends 'base.html' %}
{% block title %}Add Questions{% endblock %}
{% block content %}
<div class="container mt-5">
    <h2>Add Questions</h2>
    <form action="{{ url_for('quiz.add_questions') }}" method="POST" id="question-form">
        <div class="Questions" id="Questions_Container">
            <div class="Question" id="Question-{{curr_question}}">
                <div class="Question-text">
                    <label for="question">Question</label>
                    <input type="text" class="form-control" name="question" placeholder="Enter the question" required>
                </div>
                <div class="ques_type">
                    <label for="ques_type">Question Type</label>
                    <select name="ques_type" id="ques_type" required>
                        <option value="MCQ">MCQ</option>
                        <option value="Text">Text</option>
                    </select>
                </div>
                <div class="time-limit">
                    <p>For automatic question lock and unlock, you can add a time limit for your question</p>
                    <label for="time-limit">Time Limit: </label>
                    <div class="duration" style="display: flex;flex-direction: row; height: fit-content; align-items: start;">
                        <input type="number" name="hours" min="0" max="5" style="width: max-content; font-size: x-large;">
                        <label for="hours">hr.</label>
                        <input type="number" name="minutes" min="0" max="59" style="width: max-content; font-size: x-large;">
                        <label for="minutes">min.</label>
                        <input type="number" name="seconds" min="0" max="59" style="width: max-content; font-size: x-large;">
                        <label for="seconds">sec.</label>
                    </div>
                    <p>You can also proceed with our manual lock-unlock feature by leaving the time blocks unfilled</p>
                </div>
                {% if ques_type == 'MCQ' %}
                <div class="Options">
                    <label for="options">Options</label>
                    <div class="option" style="display: flex; flex-direction: row; height: min-content;">
                        <input type="text" class="option-text" name="option-{{curr_option}}" placeholder="Enter option" required>
                        <input type="checkbox" name="correct_option-{{curr_option}}" value="0" aria-label="Checkbox for following text input">
                        <button type="button" class="del-option">Delete</button>
                    </div>
                    <button type="button" class="add-option">Add Option</button>
                </div>
                {% elif ques_type == 'Text' %}
                <div class="Answer">
                    <label for="answer">Answer</label>
                    <input type="text" class="form-control" name="answer" placeholder="Enter the answer" required>
                </div>
                {% endif %}
            </div>
        </div>
    </form>
</div>
<script>
    $(document).ready(function() {
        let questionIndex = 0;
        let optionIndex = 0;

        function updateIndices() {
            $('.question').each(function(index) {
                $(this).find('[name^="options"]').each(function() {
                    let name = $(this).attr('name').split('-')[0];
                    $(this).attr('name', name + '-' + index);
                });
                $(this).find('[name^="correct_options"]').each(function() {
                    let name = $(this).attr('name').split('-')[0];
                    $(this).attr('name', name + '-' + index);
                });
            });
        }

        $('#add-next-question').click(function() {
            questionIndex++;
            optionIndex=0;
            var questionHtml = '<div class="question">' +
                '<div class="form-group">' +
                '<label for="question">Question '+questionIndex+'</label>' +
                '<input type="text" class="form-control" name="question" placeholder="Enter the question" required>' +
                '</div>' +
                '<div class="time-limit">' +
                '<p>For automatic question lock and unlock, you can add a time limit for your question</p>' +
                '<label for="time-limit">Time Limit: </label>' +
                '<input type="number" name="hours" min="0" max="5">' +
                '<label for="hours">hr.</label>' +
                '<input type="number" name="minutes" min="0" max="59">' +
                '<label for="minutes">min.</label>' +
                '<input type="number" name="seconds" min="0" max="59">' +
                '<label for="seconds">sec.</label>' +
                '</div>' +
                '<p>You can also proceed with our manual lock-unlock feature by leaving the time blocks unfilled</p>' +
                '<div class="options-container form-group">' +
                '<label for="options">Options</label>' +
                '<div class="input-group mb-2">' +
                '<input type="text" class="form-control" name="options-' + questionIndex + '" placeholder="Enter option" required>' +
                '<div class="input-group-append">' +
                '<div class="input-group-text">' +
                '<input type="checkbox" name="correct_options-' + questionIndex + '" value=0 aria-label="Checkbox for following text input">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<button type="button" class="btn btn-secondary mb-3 add-option">Add Option</button>' +
                '<button type="button" class="btn btn-danger mb-3 delete-question">Delete Question</button>' +
                '</div>';

            $('#questions-container').append(questionHtml);
            updateIndices();
        });

        $(document).on('click', '.add-option', function() {
            optionIndex++;
            var optionsContainer = $(this).siblings('.options-container');
            var questionIndex = $(this).closest('.question').index();
            optionsContainer.append(
                '<div class="input-group mb-2">' +
                '<input type="text" class="form-control" name="options-' + questionIndex + '" placeholder="Enter option" required>' +
                '<div class="input-group-append">' +
                '<div class="input-group-text">' +
                '<input type="checkbox" name="correct_options-' + questionIndex + '" value='+optionIndex+' aria-label="Checkbox for following text input">' +
                '</div>' +
                '</div>' +
                '</div>'
            );
        });

        $(document).on('click', '.delete-question', function() {
            $(this).closest('.question').remove();
            updateIndices();
        });
    });
</script>
{% endblock %}
